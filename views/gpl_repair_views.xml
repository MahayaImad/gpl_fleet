<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_repair_order_form_gpl_inherit" model="ir.ui.view">
        <field name="name">repair.order.form.gpl.inherit</field>
        <field name="model">repair.order</field>
        <field name="inherit_id" ref="repair.view_repair_order_form"/>
        <field name="arch" type="xml">
            <!-- Ajout des champs spécifiques GPL dans l'en-tête -->
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="gpl_vehicle_id" options="{'no_create': True}"/>
                <field name="reservoir_lot_id" readonly="1"
                       invisible="gpl_vehicle_id == False"/>
            </xpath>

            <!-- Ajout d'un nouvel onglet pour le diagnostic GPL -->
            <notebook position="inside">
                <page string="Diagnostic GPL" invisible="gpl_vehicle_id == False">
                    <field name="diagnostic" placeholder="Entrez le diagnostic détaillé du problème GPL..."/>
                </page>
            </notebook>
        </field>
    </record>


    <record id="view_repair_order_tree_gpl_inherit" model="ir.ui.view">
        <field name="name">repair.order.tree.gpl.inherit</field>
        <field name="model">repair.order</field>
        <field name="inherit_id" ref="repair.view_repair_order_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="after">
                <field name="gpl_vehicle_id" optional="show"/>
            </xpath>
        </field>
    </record>

    <!-- Vue recherche héritée pour repair.order -->
    <record id="view_repair_order_search_gpl_inherit" model="ir.ui.view">
    <field name="name">repair.order.search.gpl.inherit</field>
    <field name="model">repair.order</field>
    <field name="inherit_id" ref="repair.view_repair_order_form_filter"/>
    <field name="arch" type="xml">
        <!-- Ajouter le champ de recherche après partner_id -->
        <field name="partner_id" position="after">
            <field name="gpl_vehicle_id"/>
        </field>

        <!-- Ajouter le filtre de regroupement dans le groupe existant -->
        <filter name="product" position="after">
            <filter string="Véhicule GPL" name="group_vehicle" domain="[]" context="{'group_by': 'gpl_vehicle_id'}"/>
        </filter>
    </field>
</record>

    <!-- Action de menu pour les réparations GPL -->
    <record id="action_repair_order_gpl" model="ir.actions.act_window">
        <field name="name">Réparations GPL</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">repair.order</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('gpl_vehicle_id', '!=', False)]</field>
        <field name="context">{'default_gpl_repair': True}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Créer votre première réparation GPL
            </p>
            <p>
                Les réparations GPL vous permettent de gérer les interventions sur les installations GPL de vos véhicules.
            </p>
        </field>
    </record>

    <!-- Menu pour accéder aux réparations GPL -->
    <menuitem id="menu_repair_order_gpl"
              name="Réparations GPL"
              parent="gpl_fleet.menu_gpl_operations"
              action="action_repair_order_gpl"
              sequence="20"/>
</odoo>
